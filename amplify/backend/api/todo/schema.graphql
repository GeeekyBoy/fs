type Project
  @model
  @auth(rules: [
    { allow: owner, ownerField: "owner", operations: [create, update, delete, read] },
    { allow: owner, ownerField: "assignees", operations: [read] },
  ])
  @key(fields: ["id"])
  @key(name: "ByPermalink", fields: ["permalink"]) {
  id: ID!
  permalink: String!
  title: String!
  notes: [Note] @connection(keyName: "byProject", fields: ["id"])
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  owner: String!
  assignees: [String!]
}

type Note
  @model
  @key(name: "byProject", fields: ["projectID"]) @auth(rules: [
    { allow: owner, ownerField: "owner", operations: [create, update, delete, read] },
    { allow: owner, ownerField: "assignees", operations: [read] },
  ]) {
	id: ID!
	projectID: ID!
	note: String!
	isDone: Boolean!
	task: String
	description: String
	steps: String
	due: String
	watcher: String
	tag: [String]
	sprint: String
	status: String
  project: Project! @connection(fields: ["projectID"])
  comments: [Comment] @connection(keyName: "byNote", fields: ["id"])
	createdAt: AWSDateTime
	updatedAt: AWSDateTime
	owner: String!
	assignees: [String!]!
}

type Comment
  @model
  @key(name: "byNote", fields: ["noteID"]) @auth(rules: [
    { allow: owner, ownerField: "owner", operations: [create, update, delete, read] },
    { allow: owner, ownerField: "assignees", operations: [read] },
  ]) {
  id: ID!
  noteID: ID!
  content: String!
  note: Note! @connection(fields: ["noteID"])
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  owner: String!
  assignees: [String!]
}

type Subscription {
  onCreateCommentByNoteId(noteID: ID!): Comment
    @aws_subscribe(mutations: ["createComment"])
  onUpdateCommentByNoteId(noteID: ID!): Comment
    @aws_subscribe(mutations: ["updateComment"])
  onDeleteCommentByNoteId(noteID: ID!): Comment
    @aws_subscribe(mutations: ["deleteComment"])
  onCreateNoteByProjectId(projectID: ID!): Note
    @aws_subscribe(mutations: ["createNote"])
}

type Mutation {
  createNotee(input: CreateNoteInput!): CreateNoteInput
    @function(name: "graphqlresolver-${env}")
    @aws_iam
    @aws_cognito_user_pools
  deleteNoteAndComments(noteId: ID!): RemovalResponse
    @function(name: "graphqlresolver-${env}")
    @aws_iam
    @aws_cognito_user_pools
}

input CreateNoteInput {
	id: ID!
	projectID: ID!
	note: String!
	isDone: Boolean!
	task: String
	description: String
	steps: String
	due: String
	watcher: String
	tag: [String]
	sprint: String
	status: String
	createdAt: AWSDateTime
	updatedAt: AWSDateTime
	owner: String!
	assignees: [String!]
}

type RemovalResponse {
  id: ID!
}